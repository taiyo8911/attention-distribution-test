# 注意配分検査:運転適正検査 アプリ仕様書

## 1. アプリ概要
- **アプリ名**: 注意配分検査:運転適正検査
- **対象**: 鉄道操縦者の適性検査
- **プラットフォーム**: iOS (iPhone/iPad)
- **画面向き**: 縦向きのみ

## 2. アーキテクチャ・ファイル構成

### 2.1 フォルダ構成
```
attention-distribution-test/
├── App/
│   └── attention_distribution_testApp.swift (メインアプリファイル)
├── Views/
│   ├── ContentView.swift (メインナビゲーション管理)
│   ├── StartView.swift (スタート画面 + 開始確認ダイアログ)
│   ├── CountdownView.swift (カウントダウン画面)
│   ├── TestView.swift (メイン検査画面 + 中断確認ダイアログ)
│   ├── ResultView.swift (結果画面)
│   └── HistoryView.swift (履歴画面)
├── Components/
│   ├── GridCell.swift (7x7グリッドのセル)
│   └── TimerView.swift (タイマー表示コンポーネント)
├── Models/
│   ├── TestModel.swift (検査の状態管理)
│   ├── TestResult.swift (検査結果データ)
│   └── GameState.swift (ゲーム状態の列挙型)
├── ViewModels/
│   ├── TestViewModel.swift (メイン検査のビジネスロジック)
│   └── HistoryViewModel.swift (履歴管理)
├── Services/
│   ├── TimerService.swift (時間計測サービス)
│   └── DataService.swift (データ保存・読み込みサービス)
└── Resources/
    └── Assets.xcassets/ (アプリアイコン、色設定など)
```

### 2.2 アーキテクチャパターン
- **MVVM (Model-View-ViewModel)** パターンを採用
- **責任分離**: UI、ビジネスロジック、データ層を明確に分離
- **再利用性**: コンポーネント化により保守性を向上

## 3. 基本機能仕様

### 3.1 検査内容
- 7×7のマス目に0～48の数字を表示
- 0は必ず中央のマス（4,4）に配置
- 1～48はランダムに配置（0の位置を除く）
- 受験者は0から順番に48まで数字をタップ
- 数字をタップ後、確認ボタンを押して次に進む
- 検査完了までの時間を測定

### 3.2 UI要素仕様

#### マス目
- **配置**: 画面いっぱいに7×7のグリッド表示
- **形状**: 正方形のセル
- **背景色**: 白
- **境界線**: 黒、1pt
- **数字**: 黒文字、各セルサイズに応じた最適フォントサイズ

#### タイマー
- **位置**: 画面上部中央
- **形式**: MM:SS:mm（分:秒:ミリ秒）
- **動作**: カウントダウン画面からメイン画面に遷移と同時にカウント開始

#### 次に押すべき数字表示
- **位置**: 画面上部（タイマーと中断ボタンの下）
- **内容**: "次に押す: [数字]"
- **表示条件**: 常時表示（0から48まで順次更新）

#### 確認ボタン
- **位置**: 画面下部中央
- **ラベル**: "確認"
- **状態**: 正しい数字をタップした時のみ活性化
- **動作**: 正解なら次へ進む、間違いならエラーメッセージ表示

#### 中断ボタン
- **位置**: 画面上部（タイマーの下）
- **ラベル**: "検査をやめる"
- **動作**: 確認ダイアログ → スタート画面に戻る

#### エラーメッセージ
- **位置**: 画面上部（次に押すべき数字表示の下）
- **内容**: "⚠️ 間違いです。正しい数字をタップしてください。"
- **表示条件**: 間違った数字をタップした時に即座に表示
- **消去**: 正しい数字をタップした時に自動消去

## 4. 操作フロー

### 4.1 基本操作
1. スタート画面で「検査開始」ボタンをタップ
2. 「検査を開始しますか？」確認ダイアログ表示
3. 「YES」選択 → 3秒カウントダウン画面表示（3、2、1）
4. 検査画面に自動遷移と同時にタイマー開始、数字配置完了
5. "次に押す: 0" が表示される
6. 受験者が「0」をタップ
7. 確認ボタンをタップ
   - 正解の場合 → "次に押す: 1" に更新
8. 「1」をタップ → 確認ボタンをタップ → "次に押す: 2" に更新
9. この手順を「48」まで繰り返す
   - 間違った数字をタップした場合 → エラーメッセージ表示、確認ボタン非活性
   - 正しい数字をタップするまで次に進めない
10. 「48」の確認ボタンタップ完了 → 結果画面へ遷移

### 4.2 エラーハンドリング
- **正しいタップ**: 確認ボタンが活性化
- **間違いタップ**: 確認ボタンは非活性のまま（正しい数字をタップするまで）
- **エラーの判定**: 間違った数字をタップした時点で即座に判明（確認ボタンが活性化されない）

## 5. 画面設計

### 5.1 スタート画面
```
┌─────────────────────────┐
│                         │
│    注意配分検査         │
│   運転適正検査          │
│                         │
│                         │
│      [検査開始]         │
│                         │
│      [履歴確認]         │
│                         │
│                         │
└─────────────────────────┘
```

### 5.2 確認ダイアログ
```
┌─────────────────────────┐
│                         │
│                         │
│   検査を開始しますか？   │
│                         │
│     [YES]    [NO]       │
│                         │
│                         │
└─────────────────────────┘
```

### 5.3 カウントダウン画面
```
┌─────────────────────────┐
│                         │
│                         │
│                         │
│          3              │ ← 3、2、1と1秒ごとに変化
│                         │
│                         │
│                         │
└─────────────────────────┘
```

### 5.4 メイン検査画面（通常時）
```
┌─────────────────────────┐
│     ⏱️ 00:00:00        │ ← タイマー表示
│      [検査をやめる]      │ ← 中断ボタン
│     次に押す: 5         │ ← 次に押すべき数字
│                         │
│ ┌─┬─┬─┬─┬─┬─┬─┐ │
│ │12│03│45│...│  │  │  │ │
│ ├─┼─┼─┼─┼─┼─┼─┤ │
│ │  │37│  │...│  │  │08│ │
│ ├─┼─┼─┼─┼─┼─┼─┤ │
│ │29│  │15│...│  │42│  │ │
│ ├─┼─┼─┼─┼─┼─┼─┤ │
│ │  │  │  │ 0 │  │  │  │ │ ← 中央に0固定
│ ├─┼─┼─┼─┼─┼─┼─┤ │
│ │  │  │  │...│  │  │  │ │
│ ├─┼─┼─┼─┼─┼─┼─┤ │
│ │  │  │  │...│  │  │  │ │
│ ├─┼─┼─┼─┼─┼─┼─┤ │
│ │  │  │  │...│  │  │  │ │
│ └─┴─┴─┴─┴─┴─┴─┘ │
│                         │
│                         │
│      [確認]             │ ← 確認ボタン
└─────────────────────────┘
```

### 5.5 エラーメッセージ表示
```
┌─────────────────────────┐
│     ⏱️ 00:00:00        │ ← タイマー表示
│      [検査をやめる]      │ ← 中断ボタン
│     次に押す: 5         │ ← 次に押すべき数字
│ ⚠️ 間違いです。         │ ← エラーメッセージ
│ 正しい数字をタップして   │
│ ください。              │
│ ┌─┬─┬─┬─┬─┬─┬─┐ │
│ │  マス目省略          │ │
│ └─┴─┴─┴─┴─┴─┴─┘ │
│                         │
│                         │
│      [確認]             │ ← 確認ボタン
└─────────────────────────┘
```

### 5.6 結果画面
```
┌─────────────────────────┐
│                         │
│      検査完了           │
│                         │
│   完了時間: 02:45:32    │
│                         │
│                         │
│    [もう一度]           │
│                         │
│    [履歴確認]           │
│                         │
│    [メインへ戻る]        │
│                         │
└─────────────────────────┘
```

### 5.7 履歴画面
```
┌─────────────────────────┐
│        履歴             │
│                         │
│ 2024/03/15  02:45:32    │
│ 2024/03/14  03:12:45    │
│ 2024/03/13  02:58:21    │
│ 2024/03/12  03:05:12    │
│                         │
│                         │
│      [戻る]             │
└─────────────────────────┘
```

## 6. データ仕様

### 6.1 Models定義
#### TestModel
- 現在の検査状態（次に押すべき数字、グリッド配置、タップ履歴）
- ゲーム進行状況の管理

#### TestResult 
- 検査日時: Date型
- 完了時間: TimeInterval型（秒）
- デバイス情報: iPhone/iPad種別

#### GameState
- 検査の進行状態（.notStarted, .countdown, .inProgress, .completed など）

### 6.2 データ保存
- **方法**: UserDefaults（DataServiceで管理）
- **保存先**: ローカルストレージ
- **容量制限**: 直近100件まで

## 7. 技術仕様

### 7.1 開発環境
- **言語**: Swift
- **フレームワーク**: SwiftUI
- **最小iOS**: iOS 15.0
- **対応デバイス**: iPhone、iPad
- **アーキテクチャ**: MVVM

### 7.2 画面サイズ対応
- **iPhone**: Safe Area内で最大サイズのグリッド
- **iPad**: 中央配置、適切なマージン確保
- **フォントサイズ**: 動的調整（セルサイズの60%程度）

### 7.3 パフォーマンス要件
- **応答性**: タップ反応時間100ms以内
- **精度**: ミリ秒単位での時間計測（TimerServiceで管理）
- **安定性**: 長時間検査でもメモリリークなし

## 8. Services仕様

### 8.1 TimerService
- 高精度なタイマー機能
- 開始、停止、リセット機能
- ミリ秒単位での時間計測

### 8.2 DataService  
- UserDefaultsでの永続化
- 検査結果の保存・読み込み
- 履歴データの管理（最大100件）

## 9. セキュリティ・プライバシー
- **データ暗号化**: ローカルデータの暗号化
- **プライバシー**: 個人を特定できる情報は保存しない
- **データ共有**: 外部送信なし

## 10. 今後の拡張可能性
- **統計機能**: 平均時間、改善傾向の表示
- **設定機能**: マス目サイズ、数字範囲の調整
- **エクスポート**: CSV形式でのデータ出力
- **複数検査**: 異なるパターンの検査追加
